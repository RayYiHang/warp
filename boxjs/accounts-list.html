<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Warp è´¦å·åˆ—è¡¨</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: #f5f5f7;
        padding: 20px;
        color: #1d1d1f;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        font-size: 28px;
        margin-bottom: 10px;
      }

      .stats {
        display: flex;
        gap: 20px;
        margin-top: 15px;
      }

      .stat-item {
        background: rgba(255, 255, 255, 0.2);
        padding: 10px 15px;
        border-radius: 8px;
        flex: 1;
      }

      .stat-label {
        font-size: 12px;
        opacity: 0.9;
      }

      .stat-value {
        font-size: 24px;
        font-weight: bold;
        margin-top: 5px;
      }

      .account-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .account-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
      }

      .account-card.active {
        border: 2px solid #667eea;
        background: linear-gradient(
          to right,
          rgba(102, 126, 234, 0.05),
          rgba(255, 255, 255, 1)
        );
      }

      .account-card.banned {
        opacity: 0.6;
        background: #fff5f5;
        border: 1px solid #fed7d7;
      }

      .account-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .account-email {
        font-size: 18px;
        font-weight: 600;
        color: #1d1d1f;
      }

      .account-status {
        display: flex;
        gap: 8px;
      }

      .badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }

      .badge-active {
        background: #d4edda;
        color: #155724;
      }

      .badge-banned {
        background: #f8d7da;
        color: #721c24;
      }

      .account-meta {
        font-size: 14px;
        color: #86868b;
        margin-bottom: 15px;
      }

      .account-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5568d3;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background: #c82333;
      }

      .btn-secondary {
        background: #f5f5f7;
        color: #1d1d1f;
      }

      .btn-secondary:hover {
        background: #e8e8ed;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #86868b;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 12px;
      }

      .empty-icon {
        font-size: 64px;
        margin-bottom: 20px;
      }

      .refresh-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: #667eea;
        color: white;
        border: none;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        transition: all 0.3s;
      }

      .refresh-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
      }

      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #323232;
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s;
        z-index: 1000;
      }

      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸš€ Warp è´¦å·ç®¡ç†</h1>
        <p>ç®¡ç†ä½ çš„ Warp AI è´¦å·ï¼Œè‡ªåŠ¨åˆ‡æ¢ï¼Œé¿å…å°ç¦</p>
        <div class="stats">
          <div class="stat-item">
            <div class="stat-label">æ€»è´¦å·æ•°</div>
            <div class="stat-value" id="total-count">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">æ´»è·ƒè´¦å·</div>
            <div class="stat-value" id="active-count">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">å·²å°ç¦</div>
            <div class="stat-value" id="banned-count">-</div>
          </div>
        </div>
      </div>

      <div id="accounts-container">
        <div class="loading">
          <div class="spinner"></div>
          <p>åŠ è½½è´¦å·åˆ—è¡¨ä¸­...</p>
        </div>
      </div>
    </div>

    <button class="refresh-btn" onclick="loadAccounts()" title="åˆ·æ–°">âŸ³</button>

    <div id="toast" class="toast"></div>

    <script>
      const API_URL = "http://127.0.0.1:8888";

      // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 3000);
      }

      // æ ¼å¼åŒ–æ—¶é—´
      function formatDate(dateStr) {
        if (!dateStr) return "ä»æœªä½¿ç”¨";
        const date = new Date(dateStr);
        const now = new Date();
        const diff = now - date;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);

        if (minutes < 1) return "åˆšåˆš";
        if (minutes < 60) return `${minutes} åˆ†é’Ÿå‰`;
        if (hours < 24) return `${hours} å°æ—¶å‰`;
        if (days < 30) return `${days} å¤©å‰`;
        return date.toLocaleDateString("zh-CN");
      }

      // åŠ è½½è´¦å·åˆ—è¡¨
      async function loadAccounts() {
        try {
          const response = await fetch(`${API_URL}/accounts`);
          const data = await response.json();

          if (data.success) {
            renderAccounts(data.accounts);
            await loadStats();
          } else {
            showToast("âŒ åŠ è½½å¤±è´¥");
          }
        } catch (error) {
          document.getElementById("accounts-container").innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">âš ï¸</div>
                        <h2>æ— æ³•è¿æ¥åˆ°æ•°æ®åº“ API</h2>
                        <p style="color: #86868b; margin-top: 10px;">
                            è¯·ç¡®ä¿ warp-db-api.py æœåŠ¡æ­£åœ¨è¿è¡Œ
                        </p>
                        <button class="btn btn-primary" onclick="loadAccounts()" style="margin-top: 20px;">
                            é‡è¯•
                        </button>
                    </div>
                `;
          console.error("åŠ è½½å¤±è´¥:", error);
        }
      }

      // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
      async function loadStats() {
        try {
          const response = await fetch(`${API_URL}/stats`);
          const data = await response.json();

          if (data.success) {
            document.getElementById("total-count").textContent = data.total;
            document.getElementById("active-count").textContent = data.active;
            document.getElementById("banned-count").textContent = data.banned;
          }
        } catch (error) {
          console.error("ç»Ÿè®¡åŠ è½½å¤±è´¥:", error);
        }
      }

      // æ¸²æŸ“è´¦å·åˆ—è¡¨
      function renderAccounts(accounts) {
        const container = document.getElementById("accounts-container");

        if (accounts.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <h2>è¿˜æ²¡æœ‰è´¦å·</h2>
                        <p style="color: #86868b; margin-top: 10px;">
                            ä½¿ç”¨ Swift åº”ç”¨æˆ– API æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªè´¦å·
                        </p>
                    </div>
                `;
          return;
        }

        container.innerHTML = accounts
          .map(
            (account) => `
                <div class="account-card ${account.is_active ? "active" : ""} ${
              account.is_banned ? "banned" : ""
            }">
                    <div class="account-header">
                        <div class="account-email">${account.email}</div>
                        <div class="account-status">
                            ${
                              account.is_active
                                ? '<span class="badge badge-active">ğŸŸ¢ æ´»è·ƒ</span>'
                                : ""
                            }
                            ${
                              account.is_banned
                                ? '<span class="badge badge-banned">ğŸš« å·²å°ç¦</span>'
                                : ""
                            }
                        </div>
                    </div>
                    <div class="account-meta">
                        ğŸ“… æœ€åä½¿ç”¨: ${formatDate(account.last_used)}
                        ${
                          account.has_token
                            ? " â€¢ ğŸ”‘ Token å·²é…ç½®"
                            : " â€¢ âš ï¸ Token ç¼ºå¤±"
                        }
                    </div>
                    <div class="account-actions">
                        ${
                          !account.is_active && !account.is_banned
                            ? `
                            <button class="btn btn-primary" onclick="activateAccount('${account.email}')">
                                æ¿€æ´»æ­¤è´¦å·
                            </button>
                        `
                            : ""
                        }
                        ${
                          account.is_banned
                            ? `
                            <button class="btn btn-secondary" onclick="unbanAccount('${account.email}')">
                                è§£é™¤å°ç¦
                            </button>
                        `
                            : ""
                        }
                        <button class="btn btn-danger" onclick="deleteAccount('${
                          account.email
                        }')">
                            åˆ é™¤
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // æ¿€æ´»è´¦å·
      async function activateAccount(email) {
        try {
          const response = await fetch(`${API_URL}/activate-account`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });

          const data = await response.json();
          if (data.success) {
            showToast(`âœ… ${data.message}`);
            await loadAccounts();
          } else {
            showToast(`âŒ ${data.error}`);
          }
        } catch (error) {
          showToast("âŒ æ“ä½œå¤±è´¥");
          console.error(error);
        }
      }

      // åˆ é™¤è´¦å·
      async function deleteAccount(email) {
        if (!confirm(`ç¡®å®šè¦åˆ é™¤è´¦å· ${email} å—ï¼Ÿ`)) return;

        try {
          const response = await fetch(`${API_URL}/delete-account`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });

          const data = await response.json();
          if (data.success) {
            showToast(`âœ… ${data.message}`);
            await loadAccounts();
          } else {
            showToast(`âŒ ${data.error}`);
          }
        } catch (error) {
          showToast("âŒ æ“ä½œå¤±è´¥");
          console.error(error);
        }
      }

      // é¡µé¢åŠ è½½æ—¶è·å–è´¦å·åˆ—è¡¨
      loadAccounts();

      // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
      setInterval(loadAccounts, 30000);
    </script>
  </body>
</html>
